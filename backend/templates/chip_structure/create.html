{% extends "shared/base.html" %} {% block title %}
<title>Create Chip Structure</title>
{% endblock %} {% block page_heading %}Create Chip Structure{% endblock %} {%
block content %}

<form method="POST" id="chipStructureForm" action="/chip_structure/create">
  <!-- Name Field (prefilled with today's date) -->
  <div class="form-floating mb-3">
    <input type="text" class="form-control" id="name" name="name" placeholder="Name" value="{{form.name}}" required />
    <label>Name</label>
  </div>
  <!-- Team Selector -->
  <div class="mb-3">
    {% with selected_team_id=form.team_id %} {% include
    "team/users_team_dropdown.html" %} {% endwith %}
  </div>
  <!-- Chip Rows -->
  <div class="row mb-3" id="chipRows">
    <div class="chip-row d-flex align-items-start gap-2 mb-2">
      <div class="flex-grow-1">
        {% include "chip/create.html" %}
      </div>
      <button type="button" class="btn btn-outline-danger btn-sm remove-chip align-self-center" title="Remove chip">
        ✕
      </button>
    </div>
  </div>

  <!-- Add Chip Button -->
  <div class="mb-3 text-center">
    <button type="button" id="addChip" class="btn btn-secondary">
      <i class="bi bi-plus-lg"></i> Add Chip
    </button>
  </div>

  <!-- Submit & Back Buttons -->
  <div class="d-flex justify-content-between">
    <a href="/game/create" class="btn btn-outline-secondary"><i class="bi bi-arrow-left me-1"></i> Back</a>
    <button type="submit" class="btn btn-primary"><i class="bi bi-check-circle-fill me-1"></i> Save Chip
      Structure</button>
  </div>
</form>

{% endblock %} {% block scripts %}

<!-- Script -->
<script>
  document.addEventListener("DOMContentLoaded", () => {
    const chipRows = document.getElementById("chipRows");
    const addChipBtn = document.getElementById("addChip");

    const chipTemplate = `
            <div class="chip-row d-flex align-items-start gap-2 mb-2">
                <div class="flex-grow-1">
                    {% include "chip/create.html" %}
                </div>
                <button type="button" class="btn btn-outline-danger btn-sm remove-chip align-self-center" title="Remove chip">✕</button>
            </div>
        `;

    // Add new chip
    addChipBtn.addEventListener("click", () => {
      const wrapper = document.createElement("div");
      wrapper.innerHTML = chipTemplate.trim();
      chipRows.appendChild(wrapper.firstElementChild);
    });

    // Remove chip
    chipRows.addEventListener("click", (e) => {
      if (e.target.classList.contains("remove-chip")) {
        const rows = document.querySelectorAll(".chip-row");
        if (rows.length > 1) e.target.closest(".chip-row").remove();
      }
    });
  });
</script>

<!-- Styling -->
<style>
  .chip-row {
    margin-bottom: 0.4rem !important;
  }

  .remove-chip {
    height: 38px;
    width: 38px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .chip-row select,
  .chip-row input {
    min-height: 38px;
  }
</style>
{% endblock %}