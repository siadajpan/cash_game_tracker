{% extends "shared/base.html" %}
{% block title %}
    <title>Add on request</title>
{% endblock %}

{% block content %}

<div class="container mt-5">
    <div class="card shadow p-4">
        <h3 class="mb-4 text-center">Add-on Request</h3>

    <!-- Player Info Section -->
    <div class="mb-4">
        <h5>Player Information</h5>
        <div class="row mb-2">
            <div class="col-4 fw-bold">Nickname:</div>
            <div class="col-8">{{ player.nick }}</div>
        </div>
        <div class="row mb-2">
            <div class="col-4 fw-bold">Initial Buy-in:</div>
            <div class="col-8">{{ buy_in }}</div>
        </div>
    </div>
    <div class="mb-4">

    <h5>Add-on History</h5>
    {% set previous_addons = player.add_ons | rejectattr("id", "equalto", add_on_request.id) | list %}
    {% if previous_addons | length > 0 %}
        <ul class=" list-group-flush list-group">
            {% for add_on in previous_addons %}
                <li class="list-group-item d-flex justify-content-between align-items-center">
                    <div class="col-4">{{ add_on.amount }}</div>
                    <div class="col-4 text-center">
                        {% if add_on.status == "DECLINED" %}
                            <span class="text-danger">Declined</span>
                        {% elif add_on.status == "APPROVED" %}
                            <span class="text-success">Approved</span>
                        {% else %}
                            <span class="text-secondary">Requested</span>
                        {% endif %}
                    </div>
                    <div class="col-4 text-end">
                        {{ add_on.time.split('T')[1][:5] if 'T' in add_on.time else add_on.time }}
                    </div>
                </li>
            {% endfor %}
        </ul>
    {% else %}
        <p class="text-muted">No previous add-ons.</p>
    {% endif %}

    </div>
    <!-- Current Add-on Request -->
    <div class="mb-4">
        <h5>Current Request</h5>
        <div class="alert alert-info">
            <strong>Requested amount:</strong> {{ add_on_request.amount }}
        </div>
    </div>

    <!-- Approve / Decline Buttons -->
    <div class="d-flex justify-content-center gap-3">
        <form method="POST" action="/game/{{ game_id }}/add_on/{{ add_on_request.id }}/approve">
            <button type="submit" class="btn btn-success px-4">Accept</button>
        </form>
        <form method="POST" action="/game/{{ game_id }}/add_on/{{ add_on_request.id }}/decline">
            <button type="submit" class="btn btn-danger px-4">Decline</button>
        </form>
    </div>
</div>

</div>
{% endblock %}
