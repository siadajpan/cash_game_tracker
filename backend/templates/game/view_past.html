{% extends "shared/base.html" %}
{% block title %}<title>Past Games</title>{% endblock %}
{% block page_heading %}Past Games{% endblock %}

{% block content %}
<div id="games-view-container" class="d-flex flex-column" style="max-height: 60vh;">
    <div class="table-responsive overflow-auto" style="min-height: 0;">
        <table class="table table-hover table-hover-custom align-middle mb-0">
            <thead class="sticky-top bg-white border-bottom">
                <tr>
                    <th scope="col" class="py-2 border-0">Date</th>
                    <th scope="col" class="py-2 text-center border-0">Players</th>
                    <th scope="col" class="py-2 text-end border-0">Total Pot</th>
                    <th scope="col" class="py-2 text-end border-0">My Balance</th>
                    <th scope="col" class="py-2 border-0"></th>
                </tr>
            </thead>
            <tbody>
                {% for game in games_data %}
                <tr onclick="window.location='/game/{{ game.id }}';" style="cursor: pointer;">
                    <td class="border-bottom-0 py-2">{{ game.date }}</td>
                    <td class="text-center border-bottom-0 py-2">{{ game.players_count }}</td>
                    <td class="text-end border-bottom-0 py-2">{{ "%.2f"|format(game.total_pot) }}</td>
                    <td class="text-end border-bottom-0 py-2 {% if game.my_balance < 0 %}text-danger{% else %}text-success{% endif %}">
                        {{ "%.2f"|format(game.my_balance) }}
                    </td>
                    <td class="text-end border-bottom-0 py-2">
                        <i class="bi bi-chevron-right text-muted"></i>
                    </td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="5" class="text-center text-muted py-4">
                        No past games found.
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <div class="mt-3 flex-shrink-0 bg-white pt-2">
        <a href="/" class="btn btn-outline-secondary">Back</a>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    function adjustGamesViewHeight() {
        const container = document.getElementById('games-view-container');
        if (!container) return;
        
        // Calculate available height: Window height - container top position - bottom margin (20px)
        const rect = container.getBoundingClientRect();
        const availableHeight = window.innerHeight - rect.top - 20;
        
        // Ensure a reasonable minimum height
        container.style.maxHeight = `${Math.max(300, availableHeight)}px`;
    }

    window.addEventListener('resize', adjustGamesViewHeight);
    window.addEventListener('load', adjustGamesViewHeight);
    
    adjustGamesViewHeight();
</script>
{% endblock %}