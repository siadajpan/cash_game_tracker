{% extends "shared/base.html" %}
{% block title %}<title>Group {{ team.name }} Games</title>{% endblock %}
{% block page_heading %}Group {{ team.name }} Games{% endblock %}

{% block content %}
<div id="games-view-container" class="d-flex flex-column" style="max-height: 60vh;">
    <div class="table-responsive overflow-auto" style="min-height: 0;">
        <table class="table table-hover table-hover-custom align-middle mb-0">
            <thead class="sticky-top bg-white border-bottom">
                <tr>
                    <th scope="col" class="py-2 border-0">
                        <a href="?sort=date&order={% if sort_by == 'date' and order == 'desc' %}asc{% else %}desc{% endif %}&limit={{ limit }}"
                            class="text-dark text-decoration-none">
                            Date
                            {% if sort_by == 'date' %}
                            <i class="bi bi-caret-{% if order == 'desc' %}down{% else %}up{% endif %}-fill small"></i>
                            {% endif %}
                        </a>
                    </th>
                    <th scope="col" class="py-2 text-center border-0">
                        <a href="?sort=players&order={% if sort_by == 'players' and order == 'desc' %}asc{% else %}desc{% endif %}&limit={{ limit }}"
                            class="text-dark text-decoration-none">
                            Players
                            {% if sort_by == 'players' %}
                            <i class="bi bi-caret-{% if order == 'desc' %}down{% else %}up{% endif %}-fill small"></i>
                            {% endif %}
                        </a>
                    </th>
                    <th scope="col" class="py-2 text-end border-0">
                        <a href="?sort=pot&order={% if sort_by == 'pot' and order == 'desc' %}asc{% else %}desc{% endif %}&limit={{ limit }}"
                            class="text-dark text-decoration-none">
                            Total Pot
                            {% if sort_by == 'pot' %}
                            <i class="bi bi-caret-{% if order == 'desc' %}down{% else %}up{% endif %}-fill small"></i>
                            {% endif %}
                        </a>
                    </th>
                    <th scope="col" class="py-2 text-end border-0">
                        <a href="?sort=balance&order={% if sort_by == 'balance' and order == 'desc' %}asc{% else %}desc{% endif %}&limit={{ limit }}"
                            class="text-dark text-decoration-none">
                            My Balance
                            {% if sort_by == 'balance' %}
                            <i class="bi bi-caret-{% if order == 'desc' %}down{% else %}up{% endif %}-fill small"></i>
                            {% endif %}
                        </a>
                    </th>
                    <th scope="col" class="py-2 border-0"></th>
                </tr>
            </thead>
            <tbody>
                {% for game in games_data %}
                <tr onclick="window.location='/game/{{ game.id }}?return_url=' + encodeURIComponent(window.location.pathname + window.location.search);"
                    style="cursor: pointer;">
                    <td class="border-bottom-0 py-2">{{ game.date }}</td>
                    <td class="text-center border-bottom-0 py-2">{{ game.players_count }}</td>
                    <td class="text-end border-bottom-0 py-2">{{ "%.2f"|format(game.total_pot) }}</td>
                    <td
                        class="text-end border-bottom-0 py-2 {% if game.my_balance < 0 %}text-danger{% else %}text-success{% endif %}">
                        {{ "%.2f"|format(game.my_balance) }}
                    </td>
                    <td class="text-end border-bottom-0 py-2">
                        <i class="bi bi-chevron-right text-muted"></i>
                    </td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="5" class="text-center text-muted py-4">
                        No games found for this group.
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <div class="mt-3 flex-shrink-0 bg-white pt-2 d-flex justify-content-between align-items-center">
        <div>
            <a href="/team/{{ team.id }}" class="btn btn-outline-secondary"><i class="bi bi-arrow-left me-1"></i>
                Back</a>
        </div>
        {% if visible_count < games_count %} <div>
            <span class="text-muted me-2 small">Showing {{ visible_count }} of {{ games_count }} games</span>
            <a href="?limit=10000&sort={{ sort_by }}&order={{ order }}" class="btn btn-link pe-0"><i
                    class="bi bi-list-ul me-1"></i> Show All</a>
    </div>
    {% endif %}
</div>
</div>
{% endblock %}

{% block scripts %}
<script>
    function adjustGamesViewHeight() {
        const container = document.getElementById('games-view-container');
        if (!container) return;

        // Calculate available height: Window height - container top position - bottom margin (20px)
        const rect = container.getBoundingClientRect();
        const availableHeight = window.innerHeight - rect.top - 20;

        // Ensure a reasonable minimum height
        container.style.maxHeight = `${Math.max(300, availableHeight)}px`;
    }

    window.addEventListener('resize', adjustGamesViewHeight);
    window.addEventListener('load', adjustGamesViewHeight);

    adjustGamesViewHeight();
</script>
{% endblock %}